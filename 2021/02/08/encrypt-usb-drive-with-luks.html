<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Encrypt a USB Drive with LUKS on Linux | Stefandroid Blog</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Encrypt a USB Drive with LUKS on Linux" />
<meta name="author" content="Stefan Thoss" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Linux Unified Key Setup (LUKS) makes it easy to encrypt a removable USB drive on Linux and protect your data." />
<meta property="og:description" content="Linux Unified Key Setup (LUKS) makes it easy to encrypt a removable USB drive on Linux and protect your data." />
<link rel="canonical" href="https://blog.stefandroid.com/2021/02/08/encrypt-usb-drive-with-luks.html" />
<meta property="og:url" content="https://blog.stefandroid.com/2021/02/08/encrypt-usb-drive-with-luks.html" />
<meta property="og:site_name" content="Stefandroid Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-02-08T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Encrypt a USB Drive with LUKS on Linux" />
<meta name="google-site-verification" content="IfD8jtnHx4mJpYOmj73jbGqeMSrR8K9C5AIUW6p0Uzs" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Stefan Thoss"},"dateModified":"2024-12-07T05:28:15+00:00","datePublished":"2021-02-08T00:00:00+00:00","description":"Linux Unified Key Setup (LUKS) makes it easy to encrypt a removable USB drive on Linux and protect your data.","headline":"Encrypt a USB Drive with LUKS on Linux","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.stefandroid.com/2021/02/08/encrypt-usb-drive-with-luks.html"},"url":"https://blog.stefandroid.com/2021/02/08/encrypt-usb-drive-with-luks.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://blog.stefandroid.com/feed.xml" title="Stefandroid Blog" /><meta http-equiv="Content-Security-Policy" content="base-uri 'self'; default-src 'self' 'unsafe-inline' *.stefandroid.com;" />
  <script async defer data-domain="blog.stefandroid.com" src="https://stats.stefandroid.com/js/plausible.js" data-exclude="/last-comments"></script>
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Stefandroid Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Encrypt a USB Drive with LUKS on Linux</h1>
    <p class="post-meta"><time class="dt-published" datetime="2021-02-08T00:00:00+00:00" itemprop="datePublished">
        Feb 8, 2021
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>It’s important to back up your data. The backup is ideally stored on an encrypted drive so that nobody except for
yourself can access your data. This is especially important for removable USB drives because they can more easily get
lost or stolen. In this guide I use Linux Unified Key Setup (LUKS) for encrypting a hard drive (which can be an external
USB drive but also an internal drive). This is supported by pretty much any modern Linux system, so it’s easy to take
your drive to a different computer and access the encrypted data.</p>

<h2 id="preparation">Preparation</h2>

<p>First, install the required <code class="language-plaintext highlighter-rouge">cryptsetup</code> software:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Arch Linux / Manjaro</span>
<span class="nb">sudo </span>pacman <span class="nt">-Syu</span> cryptsetup

<span class="c"># Debian</span>
<span class="nb">sudo </span>apt <span class="nb">install </span>cryptsetup
</code></pre></div></div>

<p>Then identify the disk you want to encrypt using <code class="language-plaintext highlighter-rouge">fdisk</code>:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>fdisk <span class="nt">-l</span>
</code></pre></div></div>

<p>In this example we will be using a 6 TB disk at <code class="language-plaintext highlighter-rouge">/dev/sdx</code> (make sure to replace <code class="language-plaintext highlighter-rouge">/dev/sdx</code> with your disk going
forward):</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Disk /dev/sdx: 5.46 TiB, 6001175126016 bytes, 11721045168 sectors
Disk model: 001-2BB186
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes
</code></pre></div></div>

<h2 id="setup">Setup</h2>

<p>First we initialize a new LUKS partition on the disk. You will be asked twice for the encryption passphrase. <strong>This will
delete all data on the disk.</strong> With <code class="language-plaintext highlighter-rouge">--type luks2</code> we specify to use LUKS2, the newer implementation of LUKS. By
default, the <code class="language-plaintext highlighter-rouge">aes-xts-plain64</code> cipher with a 512 bit key is used.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>cryptsetup luksFormat <span class="nt">--type</span> luks2 /dev/sdx
</code></pre></div></div>

<p>After that we will open the newly created LUKS partition using the mapped device <code class="language-plaintext highlighter-rouge">backupDrive</code> (opening the LUKS
partition will ask you for the passphrase you just set). You can change the mapping name <code class="language-plaintext highlighter-rouge">backupDrive</code> to anything you
want for this disk. Use something unique in case you want to mount multiple LUKS encrypted partitions at the same time.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>cryptsetup luksOpen /dev/sdx backupDrive
</code></pre></div></div>

<p>The mapped block device will then be available at <code class="language-plaintext highlighter-rouge">/dev/mapper/backupDrive</code>. You can check the status of the mapped
device with</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>cryptsetup <span class="nt">-v</span> status backupDrive
</code></pre></div></div>

<p>which will list information about the block device and the encryption cipher. Example output:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/dev/mapper/backupDrive is active.
  type:    LUKS2
  cipher:  aes-xts-plain64
  keysize: 512 bits
  key location: keyring
  device:  /dev/sdx
  sector size:  512
  offset:  32768 sectors
  size:    11721012400 sectors
  mode:    read/write
Command successful.
</code></pre></div></div>

<p>The next step is to create a filesystem in the mapped block device <code class="language-plaintext highlighter-rouge">/dev/mapper/backupDrive</code>:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>mkfs <span class="nt">-t</span> ext4 <span class="nt">-V</span> /dev/mapper/backupDrive
</code></pre></div></div>

<p>The output will look something like this:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkfs from util-linux 2.36
mkfs.ext4 /dev/mapper/backupDrive
mke2fs 1.45.6 (20-Mar-2020)
Creating filesystem with 1465126550 4k blocks and 183144448 inodes
Filesystem UUID: 84326f68-6842-415e-a04b-7a3ec7e81893
Superblock backups stored on blocks:
        ...

Allocating group tables: done
Writing inode tables: done
Creating journal (262144 blocks): done
Writing superblocks and filesystem accounting information: done
</code></pre></div></div>

<p>The device can now be mounted at <code class="language-plaintext highlighter-rouge">/mnt/backupDrive</code> and the disk usage can be listed with <code class="language-plaintext highlighter-rouge">df</code>:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>mount /dev/mapper/backupDrive /mnt/backupDrive
<span class="nb">df</span> <span class="nt">-h</span>
</code></pre></div></div>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Filesystem               Size  Used Avail Use% Mounted on
...
/dev/mapper/backupDrive  5.5T   89M  5.2T   1% /mnt/backupDrive
...
</code></pre></div></div>

<p>You can now copy data to <code class="language-plaintext highlighter-rouge">/mnt/backupDrive</code>. Don’t forget to unmount before removing the drive. It’s a good idea to
practice mounting and unmounting before using the drive with valuable data - if decrypting the LUKS partition doesn’t
work the data is lost forever!</p>

<h2 id="usage">Usage</h2>

<p>Use the following commands to use the encrypted drive after the above setup is completed.</p>

<h3 id="mounting">Mounting</h3>

<p>Open/decrypt the LUKS partition <code class="language-plaintext highlighter-rouge">/dev/sdx</code> and mount the block device <code class="language-plaintext highlighter-rouge">/dev/mapper/backupDrive</code>:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>cryptsetup luksOpen /dev/sdx backupDrive
<span class="nb">sudo </span>mount /dev/mapper/backupDrive /mnt/backupDrive
</code></pre></div></div>

<h3 id="unmounting">Unmounting</h3>

<p>Unmount the block device and close the LUKS partition:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>umount /mnt/backupDrive
<span class="nb">sudo </span>cryptsetup luksClose backupDrive
</code></pre></div></div>

  </div>

  <div id="remark42"></div>

  <a class="u-url" href="/2021/02/08/encrypt-usb-drive-with-luks.html" hidden></a>
</article>

<script>
  var remark_config = {
    host: 'https://remark.stefandroid.com',
    site_id: 'STEFANDROID_BLOG',
    components: ['embed'],
    url: 'https://blog.stefandroid.com/2021/02/08/encrypt-usb-drive-with-luks.html',
    theme: 'light',
    locale: 'en',
    show_email_subscription: false
  };
</script>
<script>!function(e,n){for(var o=0;o<e.length;o++){var r=n.createElement("script"),c=".js",d=n.head||n.body;"noModule"in r?(r.type="module",c=".mjs"):r.async=!0,r.defer=!0,r.src=remark_config.host+"/web/"+e[o]+c,d.appendChild(r)}}(remark_config.components||["embed"],document);</script>

      </div>
    </main><footer class="site-footer h-card">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <ul class="contact-list">
          
        </ul>
      </div>
    </div>

    <div class="social-links">
      <ul class="social-media-list"><li><a href="https://github.com/stefanthoss" target="_blank"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">stefanthoss</span></a></li><li><a rel="me" href="https://sfba.social/@stefandroid" target="_blank"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#mastodon"></use></svg> <span>Mastodon</span></a></li><li><a href="/feed.xml"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg> <span>Subscribe via Atom</span></a></li></ul>      
    </div>

  </div>

</footer>
</body>

</html>
