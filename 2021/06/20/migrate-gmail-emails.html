<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Migrate Emails from Gmail to Another IMAP Server | Stefandroid Blog</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Migrate Emails from Gmail to Another IMAP Server" />
<meta name="author" content="Stefan Thoss" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="With imapsync it’s easy to migrate all emails from Gmail to another IMAP server without losing any metadata and translating Gmail labels to a folder structure." />
<meta property="og:description" content="With imapsync it’s easy to migrate all emails from Gmail to another IMAP server without losing any metadata and translating Gmail labels to a folder structure." />
<link rel="canonical" href="https://blog.stefandroid.com/2021/06/20/migrate-gmail-emails.html" />
<meta property="og:url" content="https://blog.stefandroid.com/2021/06/20/migrate-gmail-emails.html" />
<meta property="og:site_name" content="Stefandroid Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-06-20T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Migrate Emails from Gmail to Another IMAP Server" />
<meta name="google-site-verification" content="IfD8jtnHx4mJpYOmj73jbGqeMSrR8K9C5AIUW6p0Uzs" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Stefan Thoss"},"dateModified":"2024-12-07T05:28:15+00:00","datePublished":"2021-06-20T00:00:00+00:00","description":"With imapsync it’s easy to migrate all emails from Gmail to another IMAP server without losing any metadata and translating Gmail labels to a folder structure.","headline":"Migrate Emails from Gmail to Another IMAP Server","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.stefandroid.com/2021/06/20/migrate-gmail-emails.html"},"url":"https://blog.stefandroid.com/2021/06/20/migrate-gmail-emails.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://blog.stefandroid.com/feed.xml" title="Stefandroid Blog" /><meta http-equiv="Content-Security-Policy" content="base-uri 'self'; default-src 'self' 'unsafe-inline' *.stefandroid.com;" />
  <script async defer data-domain="blog.stefandroid.com" src="https://stats.stefandroid.com/js/plausible.js" data-exclude="/last-comments"></script>
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Stefandroid Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Migrate Emails from Gmail to Another IMAP Server</h1>
    <p class="post-meta"><time class="dt-published" datetime="2021-06-20T00:00:00+00:00" itemprop="datePublished">
        Jun 20, 2021
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>If you decided that you want to move away from Gmail, you can migrate all emails from Gmail to a different
IMAP server. Using the tool <a href="https://github.com/imapsync/imapsync"><code class="language-plaintext highlighter-rouge">imapsync</code></a> that’s an easy task. It transfers emails
from one IMAP server to another and preserves all email data including headers, attachments, timestamps, and folder structure.</p>

<p>In this guide, I’m using <code class="language-plaintext highlighter-rouge">imapsync</code> version 1.977 on Linux. Find a list of installation guides for different
Linux systems <a href="https://github.com/imapsync/imapsync/tree/master/INSTALL.d">in this directory on GitHub</a>.</p>

<p>There’s already a good official
<a href="https://github.com/imapsync/imapsync/blob/master/FAQ.d/FAQ.Gmail.txt">guide on how to use imapsync with Gmail</a>.
I encourage you to read that guide first, I’ll only describe some of the additional information I consider to be useful
in this blog post. Server 1 is Gmail and server 2 is your destination IMAP server. The destination IMAP server can
already contain emails, <code class="language-plaintext highlighter-rouge">imapsync</code> does not delete any email on the destination server by default.</p>

<p>Instead of using the <code class="language-plaintext highlighter-rouge">--password1</code>/<code class="language-plaintext highlighter-rouge">--password2</code> arguments, you should provide the passwords for the two IMAP servers
through a text file so that it’s not saved in the Shell history.</p>

<p>First the Gmail server: The IMAP server is <code class="language-plaintext highlighter-rouge">imap.gmail.com</code> and the username <code class="language-plaintext highlighter-rouge">user@gmail.com</code>. For the password you
have to generate an app password, it will not work with your Gmail account password. Google provides instructions for
<a href="https://support.google.com/accounts/answer/185833">generating app passwords</a>. Generate an App Password for the app
<em>Mail</em> and store the 16-character password in a text file called <code class="language-plaintext highlighter-rouge">password1.txt</code>. Remember to remove the app password
from your Google account after the email migration is complete. For the destination IMAP server, figure out the server
host, the username, and your password. Store the password in a file called <code class="language-plaintext highlighter-rouge">password2.txt</code>.</p>

<p>Gmail is not exposing system folders (e.g. sent emails, trash, drafts, etc.) with the <code class="language-plaintext highlighter-rouge">[Gmail]/</code> prefix anymore (the
version of <code class="language-plaintext highlighter-rouge">imapsync</code> I’m using assumes that) but with <code class="language-plaintext highlighter-rouge">[Google Mail]/</code>. You can see that in this output from a dry run:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Host1 folder   16/22 [[Google Mail]/All Mail]            Size: 6769848488 Messages: 71145 Biggest:  31498222
Host2 folder   16/22 [[Google Mail].All Mail]             does not exist yet
Host2-Host1                                                    -6769848488           -71145          -31498222
</code></pre></div></div>

<p>The command <code class="language-plaintext highlighter-rouge">--regextrans2 "s,\[Google Mail\].,,"</code> will overwrite the default behavior and replace the <code class="language-plaintext highlighter-rouge">[Google Mail]/</code>
prefix instead of the <code class="language-plaintext highlighter-rouge">[Gmail]/</code>
prefix.</p>

<p>If you have emails that have more than one label in Gmail, you have to pay special attention to this situation. The
IMAP protocol only supports folders, but not labels. Gmail will expose the labels as folders, so emails with multiple
labels will be shown in multiple folders and essentially be duplicated. Note that emails that are starred or marked as
important are also exposed through respective folders. The <code class="language-plaintext highlighter-rouge">imapsync --gmail1</code> argument includes the
<code class="language-plaintext highlighter-rouge">--skipcrossduplicates</code> argument which will copy every email only once, even when it is contained in multiple folders.
It will only copy it in the first listed folder, so pay attention to the order of folders when you perform the dry run.
Use the arguments <code class="language-plaintext highlighter-rouge">--folderfirst</code>/<code class="language-plaintext highlighter-rouge">--folderlast</code> to change the order. I use the argument <code class="language-plaintext highlighter-rouge">--folderlast "Starred"</code> to
copy all starred emails in the end, so that only starred emails without labels will be copied (all others will be copied
to the respective label folder).</p>

<p>I use the <code class="language-plaintext highlighter-rouge">--exclude "All Mail"</code> argument because I only want to copy emails with at least one label. To check which
emails I leave behind in Gmail, I use the Gmail search <code class="language-plaintext highlighter-rouge">has:nouserlabels -label:sent -label:chats -label:trash</code>.
It will list all emails that don’t have any labels, are not in the Sent folder, and are not in the trash. If you want
to transfer unlabeled emails, use <code class="language-plaintext highlighter-rouge">--folderlast "[Google Mail]/All Mail"</code> instead, which will copy all unlabeled emails
to the <code class="language-plaintext highlighter-rouge">All Mail</code> folder.</p>

<p>Before you copy the emails, perform a dry run with <code class="language-plaintext highlighter-rouge">--dry</code> which will describe what <code class="language-plaintext highlighter-rouge">imapsync</code> would do without actually
copying any emails. Carefully check the output to make sure it’s exactly what you want to do.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./imapsync <span class="nt">--host1</span> imap.gmail.com <span class="nt">--user1</span> user@gmail.com <span class="nt">--passfile1</span> password1.txt <span class="se">\</span>
    <span class="nt">--host2</span> imap.example.com <span class="nt">--user2</span> youremail@example.com <span class="nt">--passfile2</span> password2.txt <span class="se">\</span>
    <span class="nt">--gmail1</span> <span class="se">\</span>
    <span class="nt">--regextrans2</span> <span class="s2">"s,</span><span class="se">\[</span><span class="s2">Google Mail</span><span class="se">\]</span><span class="s2">.,,"</span> <span class="se">\</span>
    <span class="nt">--folderfirst</span> <span class="s2">"INBOX"</span> <span class="se">\</span>
    <span class="nt">--exclude</span> <span class="s2">"All Mail"</span> <span class="se">\</span>
    <span class="nt">--exclude</span> <span class="s2">"Important"</span> <span class="se">\</span>
    <span class="nt">--exclude</span> <span class="s2">"Spam"</span> <span class="se">\</span>
    <span class="nt">--folderlast</span> <span class="s2">"Starred"</span> <span class="se">\</span>
    <span class="nt">--addheader</span> <span class="nt">--dry</span>
</code></pre></div></div>

<p>Once you started the actual copy process without the <code class="language-plaintext highlighter-rouge">--dry</code> argument, this might take a long time. For my setup, I
averaged around 1 message per second (average message size was 160 KB). That resulted in 20 hours of copy time
for my 70,000 emails. I recommend running this command from a server, Raspberry Pi, or computer that will not be turned
off.</p>

  </div>

  <div id="remark42"></div>

  <a class="u-url" href="/2021/06/20/migrate-gmail-emails.html" hidden></a>
</article>

<script>
  var remark_config = {
    host: 'https://remark.stefandroid.com',
    site_id: 'STEFANDROID_BLOG',
    components: ['embed'],
    url: 'https://blog.stefandroid.com/2021/06/20/migrate-gmail-emails.html',
    theme: 'light',
    locale: 'en',
    show_email_subscription: false
  };
</script>
<script>!function(e,n){for(var o=0;o<e.length;o++){var r=n.createElement("script"),c=".js",d=n.head||n.body;"noModule"in r?(r.type="module",c=".mjs"):r.async=!0,r.defer=!0,r.src=remark_config.host+"/web/"+e[o]+c,d.appendChild(r)}}(remark_config.components||["embed"],document);</script>

      </div>
    </main><footer class="site-footer h-card">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <ul class="contact-list">
          
        </ul>
      </div>
    </div>

    <div class="social-links">
      <ul class="social-media-list"><li><a href="https://github.com/stefanthoss" target="_blank"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">stefanthoss</span></a></li><li><a rel="me" href="https://sfba.social/@stefandroid" target="_blank"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#mastodon"></use></svg> <span>Mastodon</span></a></li><li><a href="/feed.xml"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg> <span>Subscribe via Atom</span></a></li></ul>      
    </div>

  </div>

</footer>
</body>

</html>
